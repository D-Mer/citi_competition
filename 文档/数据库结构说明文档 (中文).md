# 数据库结构说明文档

## 0、目录

1. 说明

2. 业务

3. 基础数据

4. 其他

   附录



## 1、说明

本项目数据库采用mysql8.0，辅助以csv格式文件存储部分中间数据作为接口。

接口文件所在目录为项目路径citix\python\

主要有：

- 用户评分数据："Point.csv"
- 新基金推荐数据："recommendFile.csv"
- 旧基金推荐数据："RecommendList.csv"
- 整合推荐结果："RecommendRes.csv"
- 测试用推荐结果："TestRecommendRes.csv"
- 用户交易记录："交易记录.csv"
- 测试用用户交易记录："交易记录_小.csv"
- 基金评估数据："基金属性_新基金2.0.csv"
- 基金评估数据："基金属性_旧基金2.0.csv"
- 基金基础数据："新基金2.0.csv"
- 基金基础数据："旧基金2.0.csv"
- 用户画像数据："用户记录.csv"

由于技术和数据所限，本项目使用了爬虫技术，除算法生成的中间数据外，所有基金相关的数据均来自于[天天基金网](http://fund.eastmoney.com/)和[中财网](http://www.cfi.net.cn/)，请勿滥用本项目数据库部分代码影响相关网站的正常功能；用于滥用引起的一切后果，本项目组不承担任何责任！



## 2、业务数据



### 钱包余额变动表	finance_record

描述：记录用户钱包余额的变动信息，记录第三方支付和提现、购买和赎回基金的操作结果。

| 序号 |   字段名    |   类型   |   长度   | 允许空 | 缺省值 |             描述             |
| :--: | :---------: | :------: | :------: | :----: | :----: | :--------------------------: |
|  1   |     id      |   int    |    11    |   否   |  自增  |      表格项id，自增主键      |
|  2   | customer_id |   int    |    11    |   否   |  外键  | 用户id，必须存在于customer表 |
|  3   |   remark    | varchar  |    10    |   否   |   无   |      余额变动原因的描述      |
|  4   | trade_time  | datetime |    64    |   是   |   无   |         变动生效时间         |
|  5   |   amount    | decimal  | （20,4） |   否   |   无   |           变动金额           |
|  6   |    state    | varchar  |    10    |   是   |   无   |          记录的状态          |
|  7   |  trade_num  | varchar  |   100    |   否   |   无   |         流水号(唯一)         |



### 用户邮箱验证表	find_key

描述：记录用户修改密码时的信息。用户忘记密码时通过邮箱验证身份时产生一条记录，并于用户点击验证链接后完成验证。

| 序号 |    字段名    |  类型   | 长度 | 允许空 | 缺省值 |              描述              |
| :--: | :----------: | :-----: | :--: | :----: | :----: | :----------------------------: |
|  1   |   find_id    |   int   |  11  |   否   |  自增  |       表格项id，自增主键       |
|  2   |    email     |  char   |  50  |   否   |   无   | 用户邮箱，必须存在于customer表 |
|  3   | request_time |  char   |  15  |   否   |   无   |     用户申请修改密码的时间     |
|  4   |     used     | tinyint |  1   |   否   |   1    |        该申请是否已处理        |



### 基金推荐表	recommend

描述：记录给所有用户分别推荐的基金列表。每个用户至少推荐10个基金。

| 序号 |   字段名    | 类型 | 长度 | 允许空 | 缺省值 |               描述               |
| :--: | :---------: | :--: | :--: | :----: | :----: | :------------------------------: |
|  1   | customer_id | int  |  11  |   否   |   无   |  用户id，必须存在于customer表中  |
|  2   |  fund_code  | char |  6   |   否   |   无   | 统一基金编号，必须存在于fund表中 |



### 用户基金组合历史记录表	customer_composition

描述：记录用户购买基金组合的数据。

| 序号 |     字段名      |   类型   |  长度  | 允许空 | 缺省值 |             描述             |
| :--: | :-------------: | :------: | :----: | :----: | :----: | :--------------------------: |
|  1   | composition_id  |   int    |   11   |   否   |  自增  |     基金组合id，自增主键     |
|  2   |   customer_id   |   int    |   11   |   否   |   无   | 用户id，必须存在于customer表 |
|  3   | purchase_amount | decimal  | (20,4) |   是   |   无   |           买入金额           |
|  4   |   sold_amount   | decimal  | (20,4) |   是   |   无   |       赎回时获得的金额       |
|  5   | puerchase_time  | datetime |   64   |   否   |   无   |           买入时间           |
|  6   |    sold_time    | datetime |   64   |   是   |   无   |           赎回时间           |
|  7   |  request_time   | datetime |   64   |   是   |   无   |         申请交易时间         |



### 基金组合-基金连接表	fund_composition

描述：记录用户购买基金组合中单个基金购买的数据。

| 序号 |     字段名      |  类型   |  长度  | 允许空 | 缺省值 |    描述    |
| :--: | :-------------: | :-----: | :----: | :----: | :----: | :--------: |
|  1   | composition_id  |   int   |   11   |   否   |   无   | 基金组合id |
|  2   |     fund_id     |   int   |   11   |   否   |   无   |   基金id   |
|  3   | fund_percentage | decimal | (11,2) |   是   |   无   |  基金占比  |
|  4   |   fund_share    | decimal | (20,4) |   是   |   无   |  基金份额  |
|  5   |  purchase_loss  | decimal | (20,4) |   否   |   无   | 买入手续费 |
|  6   |    sold_loss    | decimal | (20,4) |   是   |   无   | 赎回手续费 |



## 3、基础数据

### 用户表	customer

描述：记录用户的数据。

| 序号 |   字段名    |   类型    |  长度  | 允许空 | 缺省值 |                             描述                             |
| :--: | :---------: | :-------: | :----: | :----: | :----: | :----------------------------------------------------------: |
|  1   | customer_id |    int    |   11   |   否   |  自增  |                      用户编号，自增主键                      |
|  2   |  username   |   char    |   20   |   否   |   无   | 用户名:字母或者数字开头；允许字母,数字,下划线和点(.)；5~15位之间 |
|  3   |  password   |   char    |   20   |   否   |   无   | 密码：包含大写字母、小写字母、数字、特殊符号（不是字母，数字，下划线，汉字的字符）的8位以上组合 |
|  4   |    email    | char(50)  | (20,4) |   否   |   无   |                          邮箱，唯一                          |
|  5   | email_valid |  tinyint  |   1    |   是   |   0    |                     邮箱是(1)否(0)被验证                     |
|  6   |   balance   |  decimal  | (11,2) |   是   |  0.00  |                           钱包余额                           |
|  7   |    bonus    |  decimal  | (9,2)  |   是   |  0.00  |                            总收益                            |
|  8   |  join_time  |   date    |   64   |   否   |   无   |                           注册时间                           |
|  9   | last_login  | timestamp |   64   |   是   |   无   |                         最后登录时间                         |
|  10  | question_id |    int    |   10   |   是   |   -1   |                     用户填写的问卷对应id                     |
|  11  |     ip      |  bigint   |   64   |   是   |   0    |                       最后登录的ip地址                       |
|  12  |   banned    |  tinyint  |   1    |   是   |   0    |                       该用户是否被禁用                       |



### 管理员表	manager

描述：记录管理员的数据。

| 序号 |   字段名   |   类型   | 长度 | 允许空 | 缺省值 |        描述        |
| :--: | :--------: | :------: | :--: | :----: | :----: | :----------------: |
|  1   | manager_id |   int    |  11  |   否   |  自增  | 管理员id，自增主键 |
|  2   |  username  | varchar  |  20  |   否   |   无   |    用户名，唯一    |
|  3   |  password  | varchar  |  20  |   否   |   无   |        密码        |
|  4   |   banned   | tinyint  |  1   |   否   |   0    |     是否被禁用     |
|  5   | last_login | datetime |  64  |   是   |   无   |    最后登录时间    |



### 基金表	fund

描述：记录基金的主要数据。fund_id为程序内部对基金的编号，fund_code为标准基金代码。本数据库中所有fund_id和fund_code都以此表为准。

| 序号 |       字段名        |  类型   |  长度  | 允许空 | 缺省值 |               描述               |
| :--: | :-----------------: | :-----: | :----: | :----: | :----: | :------------------------------: |
|  1   |       fund_id       |   int   |   11   |   否   |  自增  |         基金id，自增主键         |
|  2   |      fund_code      |  char   |   6    |   否   |   无   |           标准基金代码           |
|  3   |      fund_name      | varchar |  100   |   是   |   无   |             基金名称             |
|  4   |    abbreviation     | varchar |   50   |   是   |   无   |             基金简称             |
|  5   |       pinyin        | varchar |   25   |   是   |   无   |           基金简称拼音           |
|  6   |     start_time      |  date   |   24   |   是   |   无   |           基金设立日期           |
|  7   |        type         |  char   |   10   |   是   |   无   |             基金类型             |
|  8   |        scale        | decimal | (15,2) |   是   |   无   |         基金设立规模(份)         |
|  9   |   manager_company   | varchar |   50   |   是   |   无   |       基金管理公司(管理人)       |
|  10  |    manager_bank     | varchar |   50   |   是   |   无   |       基金管理银行(托管人)       |
|  11  |    fund_history     |  text   |  可变  |   是   |   无   |             基金历史             |
|  12  |     invest_type     | varchar |   25   |   是   |   无   |             投资类型             |
|  13  |       target        |  text   |  可变  |   是   |   无   |             投资目标             |
|  14  | min_purchase_amount | decimal | (11,2) |   是   |  0.00  |           最低申购金额           |
|  15  |     fund_range      |  text   |  可变  |   是   |   无   |             投资范围             |
|  16  |      min_part       | decimal | (12,6) |   是   |   无   |           最低持有份额           |
|  17  |       manager       | varchar |  225   |   是   |   无   |             基金经理             |
|  18  |    manager_link     | varchar |  225   |   是   |   无   | 基金经理链接（基金经理详细信息） |
|  19  |         url         | varchar |  100   |   是   |   无   |     详细信息链接（详细数据）     |



### 用户问卷表	questionnaire

描述：记录用户填写过的问卷回答的信息。

| 序号 |      字段名      |   类型   | 长度 | 允许空 | 缺省值 |             描述             |
| :--: | :--------------: | :------: | :--: | :----: | :----: | :--------------------------: |
|  1   | questionnaire_id |   int    |  11  |   否   |  自增  |       问卷id，自增主键       |
|  2   |   customer_id    |   int    |  11  |   否   |   无   | 用户id，必须存在于customer表 |
|  3   |      score       |   int    |  8   |   否   |   无   |           问卷得分           |
|  4   |     answers      |   char   |  18  |   否   |   无   |        用户的回答列表        |
|  5   |   last_update    | datetime |  64  |   否   |   无   |         最后更新时间         |



### 基金净值表	fund_netvalue

描述：记录基金各时期净值的数据。每天通过爬虫从互联网上获取数据而动态更新。

| 序号 |       字段名        |  类型   |  长度  | 允许空 | 缺省值 |         描述         |
| :--: | :-----------------: | :-----: | :----: | :----: | :----: | :------------------: |
|  1   |       fund_id       |   int   |   11   |   否   |  自增  |   基金id，自增主键   |
|  2   |    trading_time     |  date   |   24   |   否   |   无   |        交易日        |
|  3   |    latest_value     | decimal | (11,4) |   否   |   无   |       最新净值       |
|  4   |    daily_return     | decimal | (11,2) |   否   |  0.00  |  日回报:百分比（%）  |
|  5   |    weekly_return    | decimal | (11,2) |   否   |   无   |  周回报:百分比（%）  |
|  6   |   monthly_return    | decimal | (11,2) |   否   |   无   |  月回报:百分比（%）  |
|  7   | three_months_return | decimal | (11,2) |   否   |  0.00  | 三月回报:百分比（%） |



### 基金买入费率表	fund_buy_rates

描述：记录买入基金所需要扣掉的费率数据。

| 序号 |      字段名      |  类型   |  长度  | 允许空 | 缺省值 |                           描述                           |
| :--: | :--------------: | :-----: | :----: | :----: | :----: | :------------------------------------------------------: |
|  1   |     fund_id      |   int   |   11   |   否   |   无   |                 基金id，必须存在于fund表                 |
|  2   | description_type | tinyint |   1    |   否   |   0    | 费率描述类型：‘0’表示按百分比描述，‘1’表示按每单xx元描述 |
|  3   |   start_amount   |   int   |   11   |   否   |   无   |                      起步金额，万元                      |
|  4   |       rate       | decimal | (11,2) |   否   |   无   |                   最高费率:百分比（%）                   |



### 基金赎回费率表	fund_out

描述：记录赎回基金所需要扣掉的费率数据。

| 序号 |   字段名   |  类型   | 长度  | 允许空 | 缺省值 |           描述           |
| :--: | :--------: | :-----: | :---: | :----: | :----: | :----------------------: |
|  1   |  fund_id   |   int   |  11   |   否   |   无   | 基金id，必须存在于fund表 |
|  2   | start_days |   int   |  11   |   否   |   无   |    计算费率的起始天数    |
|  3   |    rate    | decimal | (5,2) |   否   |   无   |      对应抽取的比例      |



## 4、其他



### 无风险净值表(一年期国债)	no_risk_fee

描述：一年期的国债的净值数据。每天通过爬虫从互联网上获取数据而动态更新。

| 序号 |  字段名  |  类型   | 长度  | 允许空 | 缺省值 |  描述  |
| :--: | :------: | :-----: | :---: | :----: | :----: | :----: |
|  1   | fee_date |  date   |  24   |   否   |   无   |  日期  |
|  2   |   fee    | decimal | (6,4) |   是   |   无   | 回报率 |



### 接口









## 附录

### A：mysql建表语句

项目内路径：citix\src\sql\createTable.sql

``` mysql
create schema citix collate utf8mb4_unicode_ci;

create table customer
(
    customer_id int auto_increment comment '用户编号'
        primary key,
    username    char(20)                                   not null comment '用户名:字母或者数字开头；允许字母,数字,下划线和点(.)；5~15位之间.',
    password    char(20)                                   not null comment '密码：包含大写字母、小写字母、数字、特殊符号（不是字母，数字，下划线，汉字的字符）的8位以上组合',
    email       char(50)                                   not null comment '邮箱',
    email_valid tinyint(1)     default 0                   not null comment '邮箱是否(0)被验证',
    balance     decimal(11, 2) default 0.00                not null comment '余额',
    bonus       decimal(9, 2)  default 0.00                not null comment '收益',
    join_time   date                                       not null comment '注册时间',
    last_login  timestamp      default current_timestamp() not null on update current_timestamp() comment '最后登录时间',
    question_id int(10)        default -1                  null comment '用户填写的问卷对应id',
    ip          bigint                                     null comment '最后登录ip',
    banned      tinyint(1)     default 0                   not null comment '该账号是否被禁止',
    constraint customer_email_uindex
        unique (email),
    constraint customer_username_uindex
        unique (username)
)
    comment '消费者，即普通用户';

create table customer_composition
(
    composition_id  int auto_increment comment '基金组合id',
    customer_id     int            not null comment '消费者id',
    purchase_amount decimal(20, 4) null comment '买入金额',
    sold_amount     decimal(20, 4) null comment '卖出金额',
    purchase_time   datetime       not null comment '买入时间',
    sold_time       datetime       null comment '卖出时间',
    request_time    datetime       null comment '申请交易时间',
    constraint customer_composition_composition_id_uindex
        unique (composition_id)
);

alter table customer_composition
    add primary key (composition_id);

create table finance_record
(
    id          int auto_increment
        primary key,
    customer_id int            not null,
    remark      varchar(10)    not null,
    trade_time  datetime       null,
    amount      decimal(20, 4) not null,
    state       varchar(10)    null,
    trade_num   varchar(100)   not null,
    constraint finance_record_trade_num_uindex
        unique (trade_num),
    constraint finance_record___customer
        foreign key (customer_id) references customer (customer_id)
            on update cascade on delete cascade
);

create table find_key
(
    find_id      int auto_increment comment '找回编号'
        primary key,
    email        char(50)             not null comment '对应用户邮箱',
    request_time char(15)             not null comment '发出找回请求的时间',
    used         tinyint(1) default 0 not null comment '是否已经被使用',
    constraint find_key_customer_email_fk
        foreign key (email) references customer (email)
            on update cascade on delete cascade
);

create table fund
(
    fund_id             int auto_increment comment '基金在本数据库中的编号'
        primary key,
    fund_code           char(6)                     not null comment '基金代码',
    fund_name           varchar(100)                null comment '基金名称',
    abbreviation        varchar(50)                 null comment '基金简称',
    pinyin              varchar(25)                 null comment '基金简称拼音',
    start_time          date                        null comment '设立日期',
    type                char(10)                    null comment '基金类型',
    scale               decimal(15, 2)              null comment '基金设立规模(份）',
    manager_company     varchar(50)                 null comment '基金管理公司（基金管理人）',
    manager_bank        varchar(50)                 null comment '基金管理银行(基金托管人)',
    fund_history        text                        null comment '基金历史',
    invest_type         varchar(25)                 null comment '投资类型',
    target              text                        null comment '投资目标',
    min_purchase_amount decimal(11, 2) default 0.00 null comment '最低申购金额',
    fund_range          text                        null comment '投资范围',
    min_part            decimal(12, 6)              null comment '最低持有份额',
    manager             varchar(225)                null comment '基金经理',
    manager_link        varchar(225)                null comment '基金经理链接（基金经理详细信息）',
    url                 varchar(100)                null comment '详细信息链接（详细数据）',
    constraint fund_abbreviation_uindex
        unique (abbreviation),
    constraint fund_fund_code_uindex
        unique (fund_code)
);

create table fund_buy_rates
(
    fund_id          int                  not null comment '对应基金代码',
    description_type tinyint(1) default 0 not null comment '费率描述类型：‘0’表示按百分比描述，‘1’表示按每单xx元描述',
    start_amount     int                  not null comment ' 起步金额，万元',
    rate             decimal(11, 2)       not null comment '最高费率:百分比（%）',
    primary key (fund_id, start_amount),
    constraint fund_rates_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table fund_composition
(
    composition_id  int            not null comment '基金组合id',
    fund_id         int            not null comment '基金id',
    fund_percentage decimal(11, 2) not null comment '基金占比',
    fund_share      decimal(20, 4) null comment '基金份额',
    purchase_loss   decimal(20, 4) null comment '购买基金扣除的费率',
    sold_loss       decimal(20, 4) null comment '赎回基金扣除的费率'
);

create table fund_netvalue
(
    fund_id             int                         not null comment '对应基金代码',
    trading_time        date                        not null comment '交易日',
    latest_value        decimal(11, 4)              not null comment '最新净值',
    daily_return        decimal(11, 2) default 0.00 not null comment '日回报:百分比（%）',
    weekly_return       decimal(11, 2)              null comment '周回报:百分比（%）',
    monthly_return      decimal(11, 2)              null comment '月回报:百分比（%）',
    three_months_return decimal(11, 2)              null comment '三月回报:百分比（%）',
    primary key (fund_id, trading_time),
    constraint fund_netvalue_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table fund_out
(
    fund_id    int           not null,
    start_days int           not null comment '计算费率的起始天数
',
    rate       decimal(5, 2) not null comment '对应抽取的比例
',
    constraint fund_out_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table manager
(
    manager_id int auto_increment
        primary key,
    username   varchar(20)          not null,
    password   varchar(20)          not null,
    banned     tinyint(1) default 0 not null,
    last_login datetime             null,
    constraint manager_username_uindex
        unique (username)
);

create table no_risk_fee
(
    fee_date date          not null
        primary key,
    fee      decimal(6, 4) null
);

create table questionnaire
(
    questionnaire_id int auto_increment
        primary key,
    customer_id      int      null,
    score            int(8)   not null,
    answers          char(18) not null,
    last_update      datetime not null,
    constraint Questionnaire_customer
        foreign key (customer_id) references customer (customer_id)
            on update cascade on delete set null
);

create table recommend
(
    customer_id int     not null comment '用户id',
    fund_code   char(6) not null comment '推荐的基金代码'
);
```



### B：使用默认数据文件

该部分数据为程序最后一次正常运行的数据

可供参考学习使用

项目内路径：citix\codes\src\sql\initTable.sql