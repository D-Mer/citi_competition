# Database structure documentation

## 0、Contents

1. Introductions

2. business data

3. basic data

4. Other

   Appendix



## 1、Introductions

The database of this project adopts mysql8.0，assisting to store some intermediate data as interface in CSV format file。

The interface files are in the directory that is the project path citix\python\

Mainly have：

- User rating data："Point.csv"
- New fund recommended data："recommendFile.csv"
- Old fund recommended data："RecommendList.csv"
- Integrate recommendation results："RecommendRes.csv"
- The recommended results that is tested："TestRecommendRes.csv"
- User transaction record："交易记录.csv"
- Test user transaction records："交易记录_小.csv"
- Fund evaluation data："基金属性_新基金2.0.csv"
- Fund evaluation data："基金属性_旧基金2.0.csv"
- Fund basic data："新基金2.0.csv"
- Fund basic data："旧基金2.0.csv"
- User profile data："用户记录.csv"

Due to the limitations of technology and data, this project USES crawler technology. Except the intermediate data generated by the algorithm, all fund related data come from[天天基金网](http://fund.eastmoney.com/) and [中财网](http://www.cfi.net.cn/). Due to the abuse of all the consequences, the project team does not assume any responsibility!



## 2、Business data



### Wallet balance statement     finance_record

Description: record the changes of the user's wallet balance, record the results of third-party payment and withdrawal, purchase and redemption of funds.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :---------: | :------: | :------: | :----: | :----: | :--------------------------: |
|  1   |     id      |   int    |    11    |   NO   |  auto-increment  |      Table item id, self-increment primary key     |
|  2   | customer_id |   int    |    11    |   NO   |  foreign key  | The user id must exist in the customer table |
|  3   |   remark    | varchar  |    10    |   NO   |   NULL   |      A description of the cause of the change in balance      |
|  4   | trade_time  | datetime |    64    |   YES   |   NULL   |         Change effective time       |
|  5   |   amount    | decimal  | （20,4） |   NO   |   NULL   |           Changes in the amount           |
|  6   |    state    | varchar  |    10    |   YES   |   NULL   |          State of record         |
|  7   |  trade_num  | varchar  |   100    |   NO   |   NULL   |         Serial number (unique)        |



### User mailbox validation table      find_key

Description: record the information when the user changes the password. When the user forgets the password and authenticates through the mailbox, a record is generated, and the authentication is completed after the user clicks the authentication link.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :----------: | :-----: | :--: | :----: | :----: | :----------------------------: |
|  1   |   find_id    |   int   |  11  |   NO  | auto-increment |       Table item id, self-increment primary key       |
|  2   |    email     |  char   |  50  |   NO   |   NULL   | The user mailbox must exist in the customer table |
|  3   | request_time |  char   |  15  |   NO   |   NULL   |     The time when the user applies for changing the password     |
|  4   |     used     | tinyint |  1   |   NO   |   1    |        Whether the application has been processed       |



### Fund recommendation form	recommend

Description: records a list of funds recommended to all users separately. Each user recommends at least 10 funds.。

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :---------: | :--: | :--: | :----: | :----: | :------------------------------: |
|  1   | customer_id | int  |  11  |   NO   |   NULL   |  The user id must exist in the customer table  |
|  2   |  fund_code  | char |  6   |   NO   |   NULL   | Uniform fund number must exist in fund table |



### User fund portfolio history sheet	customer_composition

Description: records the data of the fund portfolio purchased by the user.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :-------------: | :------: | :----: | :----: | :----: | :--------------------------: |
|  1   | composition_id  |   int    |   11   |   NO   |  auto-increment  |     Fund portfolio id, self-increment primary key     |
|  2   |   customer_id   |   int    |   11   |   NO   |   NULL   | The user id must exist in the customer table |
|  3   | purchase_amount | decimal  | (20,4) |   YES   |   NULL   |           Money           |
|  4   |   sold_amount   | decimal  | (20,4) |   TES   |   NULL   | The amount obtained at redemption |
|  5   | puerchase_time  | datetime |   64   |   NO   |   NULL   |           Buying time          |
|  6   |    sold_time    | datetime |   64   |   YES   |   NULL   |           Time of redemption           |
|  7   |  request_time   | datetime |   64   |   YES   |   NULL   |         Time to apply for the transaction         |



### Fund portfolio-fund connecting sheet  fund_composition

Description: records the data of individual fund purchases in the user's fund portfolio.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :-------------: | :-----: | :----: | :----: | :----: | :--------: |
|  1   | composition_id  |   int   |   11   |   NO   |   NULL  | Fund protfolio's id |
|  2   |     fund_id     |   int   |   11   |   NO   |   NULL   |   Fund's id   |
|  3   | fund_percentage | decimal | (11,2) |   YES   |   NULL   |  Proportion of fund  |
|  4   |   fund_share    | decimal | (20,4) |   YES  |   NULL   |  Share of fund  |
|  5   |  purchase_loss  | decimal | (20,4) |   NO   |   NULL  | Buying fee |
|  6   |    sold_loss    | decimal | (20,4) |   YES   |   NULL  | Redemption fee |



## 3、Basic data

### Customer's table  customer

Description: record users' data.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :---------: | :-------: | :----: | :----: | :----: | :----------------------------------------------------------: |
|  1   | customer_id |    int    |   11   |   NO   |  Auto-increment  |                      User number, self-increment primary key                    |
|  2   |  username   |   char    |   20   |   NO   |   NULL   | User name: starts with letters or Numbers; Allow letters, Numbers, underscores and dots (.); Between 5 ~ 15 |
|  3   |  password   |   char    |   20   |   NO   |   NULL   | Password: a combination of more than 8 digits including upper case, lower case, Numbers, special symbols (not letters, Numbers, underscores, Chinese characters) |
|  4   |    email    | char(50)  | (20,4) |   NO   |   NULL   |                          Email, the only                          |
|  5   | email_valid |  tinyint  |   1    |   YES   |   0    |                     Mailbox yes (1) no (0) is verified                    |
|  6   |   balance   |  decimal  | (11,2) |   YES   |  0.00  |                          The wallet balance                         |
|  7   |    bonus    |  decimal  | (9,2)  |   YES   |  0.00  |                          Total revenue                           |
|  8   |  join_time  |   date    |   64   |   NO   |   NULL   |                           Registration time                           |
|  9   | last_login  | timestamp |   64   |   YES   |   NULL   |                        Last landing time                         |
|  10  | question_id |    int    |   10   |   YES   |   -1   |                    The id corresponding to the questionnaire filled by the user                     |
|  11  |     ip      |  bigint   |   64   |   YES   |   0    |                       The IP address of the last login                       |
|  12  |   banned    |  tinyint  |   1    |   YES   |   0    |                       Whether the user is disabled                      |



### manager's sheet    manager

Description: records managers' data.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :--------: | :------: | :--: | :----: | :----: | :----------------: |
|  1   | manager_id |   int    |  11  |   NO   |   Auto-increment   | Administrator id, self-increment primary key |
|  2   |  username  | varchar  |  20  |   NO   |   NULL   |    Username, unique    |
|  3   |  password  | varchar  |  20  |   NO   |   NULL   |        Password        |
|  4   |   banned   | tinyint  |  1   |   NO   |   0    |     Whether it's disabled or not     |
|  5   | last_login | datetime |  64  |   YES   |   NULL   |     Last landing time     |



### Funds' sheet	fund

Description: record the main data of the fund. Fund_id is the number of funds within the program, and fund_code is the standard fund code. All fund_id and fund_code in this database are based on this table.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :-----------------: | :-----: | :----: | :----: | :----: | :------------------------------: |
|  1   |       fund_id       |   int   |   11   |   NO   |  Auto-increment  |         Fund id, since the primary key         |
|  2   |      fund_code      |  char   |   6    |   NO   |   NULL   |           Standard fund code        |
|  3   |      fund_name      | varchar |  100   |   YES  |   NULL   |             Fund Name             |
|  4   |    abbreviation     | varchar |   50   |   YES   |   NULL   |             Abbreviation of fund             |
|  5   |       pinyin        | varchar |   25   |   YES  |   NULL   |           Pinyin for fund abbreviation          |
|  6   |     start_time      |  date   |   24   |   YES   |   NULL   |           Date of fund's establishment           |
|  7   |        type         |  char   |   10   |   YES   |   NULL   |             Types of funds             |
|  8   |        scale        | decimal | (15,2) |   YES   |   NULL   |         Fund establishment scale         |
|  9   |   manager_company   | varchar |   50   |   YES   |   NULL  |       Fund management company (manager)      |
|  10  |    manager_bank     | varchar |   50   |   YES   |   NULL   |       Fund management bank (custodian)      |
|  11  |    fund_history     |  text   |  Variable  |   YES   |   NULL   |             Funds history            |
|  12  |     invest_type     | varchar |   25   |   YES   |   NULL   |             Investment type            |
|  13  |       target        |  text   |  Variable  |   YES   |   NULL   |             Investment objective             |
|  14  | min_purchase_amount | decimal | (11,2) |   YES   |  0.00  |           Minimum Investment Amount           |
|  15  |     fund_range      |  text   |  Variable  |   YES   |   NULL  |             Scope of investment             |
|  16  |      min_part       | decimal | (12,6) |   YES   |   NULL   |           Minimum share          |
|  17  |       manager       | varchar |  225   |   YES   |   NULL   |             fund manager             |
|  18  |    manager_link     | varchar |  225   |   YES  |   NULL  | Fund manager link (fund manager details) |
|  19  |         url         | varchar |  100   |   YES   |   NULL   |    Details link (details data)     |



### UserS' questionnaire sheet	questionnaire

Description: record the information the user answered in the questionnaire.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :--------------: | :------: | :--: | :----: | :----: | :--------------------------: |
|  1   | questionnaire_id |   int    |  11  |   NO  |  Auto-increment  |       Questionnaire id, self-increment primary key       |
|  2   |   customer_id    |   int    |  11  |   NO   |   NULL   | The user id must exist in the customer table |
|  3   |      score       |   int    |  8   |   NO   |   NULL   |           Questionnaire scores           |
|  4   |     answers      |   char   |  18  |   NO  |   NULL   |        List of user responses       |
|  5   |   last_update    | datetime |  64  |   NO   |   NULL   |         Last update time          |



### Fund net sheet     fund_netvalue

Description: records the net value of the fund for each period. Every day through the crawler from the Internet to obtain data and dynamic updates.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :-----------------: | :-----: | :----: | :----: | :----: | :------------------: |
|  1   |       fund_id       |   int   |   11   |   NO  |  Auto-increment  |   Fund id，self-increment primary key   |
|  2   |    trading_time     |  date   |   24   |   NO  |   NULL   |        Trade date       |
|  3   |    latest_value     | decimal | (11,4) |   NO   |   NULL   |       The latest net      |
|  4   |    daily_return     | decimal | (11,2) |   NO   |  0.00  |  Daily return: percentage (%)  |
|  5   |    weekly_return    | decimal | (11,2) |   NO   |   NULL   |  Weekly return: percentage (%)  |
|  6   |   monthly_return    | decimal | (11,2) |   NO   |   NULL   |  Monthly return: percentage (%)  |
|  7   | three_months_return | decimal | (11,2) |   NO  |  0.00  | Recent three-month yield:percentage (%)  |



###Fund buying rate sheet	fund_buy_rates

Description: record the rate data deducted to buy the fund.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :--------------: | :-----: | :----: | :----: | :----: | :------------------------------------------------------: |
|  1   |     fund_id      |   int   |   11   |   NO   |   NULL   |                 The fund id must exist in the fund sheet              |
|  2   | description_type | tinyint |   1    |  NO   |   0    | Rate description type: '0' means described by percentage, '1' means described by xx yuan per order |
|  3   |   start_amount   |   int   |   11   |   NO   |   NULL   |                      Starting amount: ten thousand yuan                      |
|  4   |       rate       | decimal | (11,2) |   NO   |   NULL   |                   Maximum rate: percentage (%)                   |



### Fund redemption rate sheet	fund_out

Description: record the rate data deducted to redeem the fund.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :--------: | :-----: | :---: | :----: | :----: | :----------------------: |
|  1   |  fund_id   |   int   |  11   |   NO   |   NULL   |   The fund id must exist in the fund sheet   |
|  2   | start_days |   int   |  11   |   NO   |   NULL   |   The number of days from which the rate is calculated    |
|  3   |    rate    | decimal | (5,2) |   NO   |   NULL   |      proportion of extraction      |



## 4、Other



### Risk-free net worth sheet (one-year Treasury bonds)   no_risk_fee

Caption: the net value of a one-year Treasury bond. Every day through the crawler from the Internet to obtain data and dynamic updates.

| Number |   Field name    |   Types   |   Length   | Allow empty | Default value |          description            |
| :--: | :------: | :-----: | :---: | :----: | :----: | :----: |
|  1   | fee_date |  date   |  24   |   NO   |   NULL   |  Date  |
|  2   |   fee    | decimal | (6,4) |   YES  |   NULL   | Rate of return |



### Interface









## Appendix

### A：mysql building table statements

Project path：citix\src\sql\createTable.sql

``` mysql
create schema citix collate utf8mb4_unicode_ci;

create table customer
(
    customer_id int auto_increment comment '用户编号'
        primary key,
    username    char(20)                                   not null comment '用户名:字母或者数字开头；允许字母,数字,下划线和点(.)；5~15位之间.',
    password    char(20)                                   not null comment '密码：包含大写字母、小写字母、数字、特殊符号（不是字母，数字，下划线，汉字的字符）的8位以上组合',
    email       char(50)                                   not null comment '邮箱',
    email_valid tinyint(1)     default 0                   not null comment '邮箱是否(0)被验证',
    balance     decimal(11, 2) default 0.00                not null comment '余额',
    bonus       decimal(9, 2)  default 0.00                not null comment '收益',
    join_time   date                                       not null comment '注册时间',
    last_login  timestamp      default current_timestamp() not null on update current_timestamp() comment '最后登录时间',
    question_id int(10)        default -1                  null comment '用户填写的问卷对应id',
    ip          bigint                                     null comment '最后登录ip',
    banned      tinyint(1)     default 0                   not null comment '该账号是否被禁止',
    constraint customer_email_uindex
        unique (email),
    constraint customer_username_uindex
        unique (username)
)
    comment '消费者，即普通用户';

create table customer_composition
(
    composition_id  int auto_increment comment '基金组合id',
    customer_id     int            not null comment '消费者id',
    purchase_amount decimal(20, 4) null comment '买入金额',
    sold_amount     decimal(20, 4) null comment '卖出金额',
    purchase_time   datetime       not null comment '买入时间',
    sold_time       datetime       null comment '卖出时间',
    request_time    datetime       null comment '申请交易时间',
    constraint customer_composition_composition_id_uindex
        unique (composition_id)
);

alter table customer_composition
    add primary key (composition_id);

create table finance_record
(
    id          int auto_increment
        primary key,
    customer_id int            not null,
    remark      varchar(10)    not null,
    trade_time  datetime       null,
    amount      decimal(20, 4) not null,
    state       varchar(10)    null,
    trade_num   varchar(100)   not null,
    constraint finance_record_trade_num_uindex
        unique (trade_num),
    constraint finance_record___customer
        foreign key (customer_id) references customer (customer_id)
            on update cascade on delete cascade
);

create table find_key
(
    find_id      int auto_increment comment '找回编号'
        primary key,
    email        char(50)             not null comment '对应用户邮箱',
    request_time char(15)             not null comment '发出找回请求的时间',
    used         tinyint(1) default 0 not null comment '是否已经被使用',
    constraint find_key_customer_email_fk
        foreign key (email) references customer (email)
            on update cascade on delete cascade
);

create table fund
(
    fund_id             int auto_increment comment '基金在本数据库中的编号'
        primary key,
    fund_code           char(6)                     not null comment '基金代码',
    fund_name           varchar(100)                null comment '基金名称',
    abbreviation        varchar(50)                 null comment '基金简称',
    pinyin              varchar(25)                 null comment '基金简称拼音',
    start_time          date                        null comment '设立日期',
    type                char(10)                    null comment '基金类型',
    scale               decimal(15, 2)              null comment '基金设立规模(份）',
    manager_company     varchar(50)                 null comment '基金管理公司（基金管理人）',
    manager_bank        varchar(50)                 null comment '基金管理银行(基金托管人)',
    fund_history        text                        null comment '基金历史',
    invest_type         varchar(25)                 null comment '投资类型',
    target              text                        null comment '投资目标',
    min_purchase_amount decimal(11, 2) default 0.00 null comment '最低申购金额',
    fund_range          text                        null comment '投资范围',
    min_part            decimal(12, 6)              null comment '最低持有份额',
    manager             varchar(225)                null comment '基金经理',
    manager_link        varchar(225)                null comment '基金经理链接（基金经理详细信息）',
    url                 varchar(100)                null comment '详细信息链接（详细数据）',
    constraint fund_abbreviation_uindex
        unique (abbreviation),
    constraint fund_fund_code_uindex
        unique (fund_code)
);

create table fund_buy_rates
(
    fund_id          int                  not null comment '对应基金代码',
    description_type tinyint(1) default 0 not null comment '费率描述类型：‘0’表示按百分比描述，‘1’表示按每单xx元描述',
    start_amount     int                  not null comment ' 起步金额，万元',
    rate             decimal(11, 2)       not null comment '最高费率:百分比（%）',
    primary key (fund_id, start_amount),
    constraint fund_rates_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table fund_composition
(
    composition_id  int            not null comment '基金组合id',
    fund_id         int            not null comment '基金id',
    fund_percentage decimal(11, 2) not null comment '基金占比',
    fund_share      decimal(20, 4) null comment '基金份额',
    purchase_loss   decimal(20, 4) null comment '购买基金扣除的费率',
    sold_loss       decimal(20, 4) null comment '赎回基金扣除的费率'
);

create table fund_netvalue
(
    fund_id             int                         not null comment '对应基金代码',
    trading_time        date                        not null comment '交易日',
    latest_value        decimal(11, 4)              not null comment '最新净值',
    daily_return        decimal(11, 2) default 0.00 not null comment '日回报:百分比（%）',
    weekly_return       decimal(11, 2)              null comment '周回报:百分比（%）',
    monthly_return      decimal(11, 2)              null comment '月回报:百分比（%）',
    three_months_return decimal(11, 2)              null comment '三月回报:百分比（%）',
    primary key (fund_id, trading_time),
    constraint fund_netvalue_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table fund_out
(
    fund_id    int           not null,
    start_days int           not null comment '计算费率的起始天数
',
    rate       decimal(5, 2) not null comment '对应抽取的比例
',
    constraint fund_out_fund_fund_id_fk
        foreign key (fund_id) references fund (fund_id)
            on update cascade on delete cascade
);

create table manager
(
    manager_id int auto_increment
        primary key,
    username   varchar(20)          not null,
    password   varchar(20)          not null,
    banned     tinyint(1) default 0 not null,
    last_login datetime             null,
    constraint manager_username_uindex
        unique (username)
);

create table no_risk_fee
(
    fee_date date          not null
        primary key,
    fee      decimal(6, 4) null
);

create table questionnaire
(
    questionnaire_id int auto_increment
        primary key,
    customer_id      int      null,
    score            int(8)   not null,
    answers          char(18) not null,
    last_update      datetime not null,
    constraint Questionnaire_customer
        foreign key (customer_id) references customer (customer_id)
            on update cascade on delete set null
);

create table recommend
(
    customer_id int     not null comment '用户id',
    fund_code   char(6) not null comment '推荐的基金代码'
);
```



### B：Use default data files

This part of data is the data of the last normal operation of the program

It can be used for reference study

Project path：citix\codes\src\sql\initTable.sql